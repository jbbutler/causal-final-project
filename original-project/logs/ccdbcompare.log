--------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/logs/ccdbcompare.log
  log type:  text
 opened on:  20 Jun 2018, 14:49:01

. clear;

. /*******************************************************************************
> *Create LHS panel of Table 3;
> *******************************************************************************/
> 
> *Get means;
. use "$raw/ccdb1972/final.dta";

. global vars "pctfemhd pctlowinc pctlths pctblack medfaminc unemrate";

. eststo clear;

. bysort category: eststo: quietly estpost summarize totpop, listwise;

--------------------------------------------------------------------------------------------------------------------------------
-> not in Census
(est1 stored)

--------------------------------------------------------------------------------------------------------------------------------
-> low coverage
(est2 stored)

--------------------------------------------------------------------------------------------------------------------------------
-> high coverage
(est3 stored)

. bysort category: eststo: quietly estpost summarize $vars [weight=totpop], listwise;
(frequency weights assumed)

--------------------------------------------------------------------------------------------------------------------------------
-> not in Census
(est4 stored)

--------------------------------------------------------------------------------------------------------------------------------
-> low coverage
(est5 stored)

--------------------------------------------------------------------------------------------------------------------------------
-> high coverage
(est6 stored)

. esttab, cells("mean(fmt(1))") title(Summary Statistics) mtitle("NIS" "Weak" "Strong" "NIS" "Weak" "Strong");

Summary Statistics
------------------------------------------------------------------------------------------
                      (1)          (2)          (3)          (4)          (5)          (6)
                      NIS         Weak       Strong          NIS         Weak       Strong
                     mean         mean         mean         mean         mean         mean
------------------------------------------------------------------------------------------
totpop            27465.5     350343.4     386814.1                                       
pctfemhd                                                     9.4         11.3         12.1
pctlowinc                                                   26.1         16.1         17.4
pctlths                                                     52.5         44.6         45.0
pctblack                                                     8.7         11.4         13.4
medfaminc                                                 8389.1      10605.1      10201.0
unemrate                                                     4.4          4.5          4.3
------------------------------------------------------------------------------------------
N                    2674          191          153         2674          191          153
------------------------------------------------------------------------------------------

. *Get p-values in column 3;
. gen weakrec = uhfclosest == 1 | far == 1;

. drop if category == 1;
(2,679 observations deleted)

. matrix p = J(7,1,.);

. local i = 1;

. qui regress totpop weakrec, robust;

.         mat table = r(table);

.         matrix p[`i++',1] = table[4,1];

. foreach var in $vars {;
  2.         qui regress `var' weakrec [weight=totpop], robust;
  3.         mat table = r(table);
  4.         matrix p[`i++',1] = table[4,1];
  5. };

. mat list p;

p[7,1]
           c1
r1  .56463477
r2   .2735811
r3  .12388202
r4  .79439671
r5  .27243557
r6  .11659272
r7  .53517353

. /*******************************************************************************
> Create RHS panel of Table 3
> *******************************************************************************/
> 
> *Clean data, create vars;
. use "$raw/ccdb1972/final.dta", clear;

. append using "$raw/ccdb1962/final.dta";
(label catlbl already defined)

. gen weakrec = uhfclosest == 1 | far == 1;

. drop if ctyfips == 510 | ctyfips == 550 | ctyfips == 810;
(11 observations deleted)

. drop if category == 1;
(5,344 observations deleted)

. gen stcty = 1000*stfips + ctyfips;

. replace year = year - 1900;
(678 real changes made)

. reshape wide totpop medfaminc pctlowinc pctfemhd pctlths pctblack unemrate,
>    i(stcty) j(year);
(note: j = 60 70)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                      678   ->     340
Number of variables                  16   ->      22
j variable (2 values)              year   ->   (dropped)
xij variables:
                                 totpop   ->   totpop60 totpop70
                              medfaminc   ->   medfaminc60 medfaminc70
                              pctlowinc   ->   pctlowinc60 pctlowinc70
                               pctfemhd   ->   pctfemhd60 pctfemhd70
                                pctlths   ->   pctlths60 pctlths70
                               pctblack   ->   pctblack60 pctblack70
                               unemrate   ->   unemrate60 unemrate70
-----------------------------------------------------------------------------

.  gen chgpctlths = (pctlths70 - pctlths60)/pctlths60;
(2 missing values generated)

. gen chgblack = (pctblack70 - pctblack60)/pctblack60;
(2 missing values generated)

. gen chgunem = unemrate70 - unemrate60;
(2 missing values generated)

. gen chgmedinc = (medfaminc70 - medfaminc60)/medfaminc60;
(2 missing values generated)

. gen chgpop = (totpop70 - totpop60)/totpop60;
(2 missing values generated)

. egen avepop = rmean(totpop60 totpop70);

. *Get means;
. global vars "chgpctlths chgblack chgmedinc chgunem";

. eststo clear;

. bysort category: eststo: quietly estpost summarize chgpop [weight=totpop60], listwise;
(frequency weights assumed)

--------------------------------------------------------------------------------------------------------------------------------
-> low coverage
(est1 stored)

--------------------------------------------------------------------------------------------------------------------------------
-> high coverage
(est2 stored)

. bysort category: eststo: quietly estpost summarize $vars [aweight=avepop], listwise;

--------------------------------------------------------------------------------------------------------------------------------
-> low coverage
(est3 stored)

--------------------------------------------------------------------------------------------------------------------------------
-> high coverage
(est4 stored)

. esttab, cells("mean(fmt(3))") title(Summary Statistics) mtitle("Weak" "Strong" "Weak" "Strong");

Summary Statistics
----------------------------------------------------------------
                      (1)          (2)          (3)          (4)
                     Weak       Strong         Weak       Strong
                     mean         mean         mean         mean
----------------------------------------------------------------
chgpop              0.184        0.162                          
chgpctlths                                   -0.196       -0.203
chgblack                                      0.170        0.022
chgmedinc                                     0.674        0.669
chgunem                                      -0.754       -0.740
----------------------------------------------------------------
N                     187          151          187          151
----------------------------------------------------------------

. *Get p-values;
. matrix p = J(5,1,.);

. local i = 1;

. qui regress chgpop weakrec [weight=totpop60], robust;

.         mat table = r(table);

.         matrix p[`i++',1] = table[4,1];

. foreach var in $vars {;
  2.         qui regress `var' weakrec [weight=avepop], robust;
  3.         mat table = r(table);
  4.         matrix p[`i++',1] = table[4,1];
  5. };

. mat list p;

p[5,1]
           c1
r1  .49189332
r2  .49977163
r3  .05803764
r4  .84038095
r5  .95754001

. log close;
      name:  <unnamed>
       log:  C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/logs/ccdbcompare.log
  log type:  text
 closed on:  20 Jun 2018, 14:49:02
--------------------------------------------------------------------------------------------------------------------------------
