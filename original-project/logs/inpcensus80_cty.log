--------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/logs/inpcensus80_cty.log
  log type:  text
 opened on:  20 Jun 2018, 14:35:34

. **********************
> 
> INPCENSUS80_CTY
> 
> **********************
> 
> This program inputs data from the 1980 Census to be used to examine whether
> the introduction of Sesame Street had an impact on school enrollment. This
> version is based on county level data. Since county of birth is not identified,
> the sample is restricted to those who live in the same state as they were born
> in. Using county identifiers also means losing about half of the observations
> because they have missing county identifiers;
. set more 1;

. clear;

. infix 
>   int     year       1-4     
>   byte    datanum    5-6     
>   double  serial     7-14    
>   float   hhwt       15-24   
>   byte    statefip   25-26   
>   int     county     27-30   
>   byte    gq         31-31   
>   int     pernum     32-35   
>   float   perwt      36-45   
>   byte    momloc     46-47   
>   byte    sex        48-48   
>   int     age        49-51   
>   byte    birthqtr   52-52   
>   int     birthyr    53-56   
>   byte    race       57-57   
>   int     raced      58-60   
>   byte    hispan     61-61   
>   int     hispand    62-64   
>   int     bpl        65-67   
>   long    bpld       68-72   
>   int     yrimmig    73-76   
>   byte    language   77-78   
>   int     languaged  79-82   
>   byte    speakeng   83-83   
>   byte    school     84-84   
>   byte    higrade    85-86   
>   int     higraded   87-89   
>   byte    educ       90-91   
>   int     educd      92-94   
>   byte    gradeatt   95-95   
>   byte    gradeattd  96-97   
>   int     migplac5   98-100  
>   int     migcogrp   101-103 
>   byte    samemet5   104-104 
>   byte    migsamp    105-105 
>   using "$raw/census1980.dat";
(11,343,120 observations read)

. save "$temp/temp1.dta", replace;
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/temp1.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/temp1.dta saved

. gen momid = pernum;

. sort year datanum serial pernum;

. rename age momage;

. rename bpl mombpl;

. rename higrade momhigrad;

. rename educd momeduc;

. rename speakeng momspeakeng;

. keep year datanum serial pernum momage mombpl momhigrad momeduc momspeakeng
>      momid;

. sort year datanum serial momid;

. save "$temp/tempmom.dta", replace;
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempmom.dta saved

. clear;

. use "$temp/temp1.dta";

.   keep if birthyr >= 1959 & birthyr <= 1975;
(8,127,353 observations deleted)

. gen nomom = momloc == 0;

. tab birthyr nomom;

           |         nomom
   birthyr |         0          1 |     Total
-----------+----------------------+----------
      1959 |    90,020    124,241 |   214,261 
      1960 |   114,253    107,324 |   221,577 
      1961 |   133,281     78,345 |   211,626 
      1962 |   181,165     31,025 |   212,190 
      1963 |   188,891     20,593 |   209,484 
      1964 |   190,445     15,884 |   206,329 
      1965 |   182,603     13,173 |   195,776 
      1966 |   174,252     10,956 |   185,208 
      1967 |   169,635      9,716 |   179,351 
      1968 |   170,605      9,046 |   179,651 
      1969 |   175,714      9,413 |   185,127 
      1970 |   184,808      9,119 |   193,927 
      1971 |   167,266      7,813 |   175,079 
      1972 |   159,758      7,759 |   167,517 
      1973 |   151,529      7,185 |   158,714 
      1974 |   153,375      7,056 |   160,431 
      1975 |   152,495      7,024 |   159,519 
-----------+----------------------+----------
     Total | 2,740,095    475,672 | 3,215,767 


. rename momloc momid;

. replace momid = . if momid == 0;
(475,672 real changes made, 475,672 to missing)

. sort year datanum serial momid;

. merge year datanum serial momid 
>      using "$temp/tempmom.dta";
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial momid do not uniquely identify observations in the master data
(note: variable momid was byte, now float to accommodate using data's values)

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    475,672        3.62        3.62
          2 |  9,933,820       75.54       79.16
          3 |  2,740,095       20.84      100.00
------------+-----------------------------------
      Total | 13,149,587      100.00

. drop if _merge == 2;
(9,933,820 observations deleted)

. gen livwmom = _merge == 3;

. drop _merge;

. gen momhsdrop = momeduc < 60;

.      replace momhsdrop = . if nomom == 1;
(475,672 real changes made, 475,672 to missing)

. gen momhsgrad = momeduc == 60;

.      replace momhsgrad = . if nomom == 1;
(475,672 real changes made, 475,672 to missing)

. gen momanycol = momeduc > 60;

.      replace momanycol = . if nomom == 1;
(475,672 real changes made, 475,672 to missing)

.          gen momhsdrop2 = momhsdrop;
(475,672 missing values generated)

.      replace momhsdrop2 = 0 if livwmom == 0;
(475,672 real changes made)

. gen momhsgrad2 = momhsgrad;
(475,672 missing values generated)

.      replace momhsgrad2 = 0 if livwmom == 0;
(475,672 real changes made)

. gen momanycol2 = momanycol;
(475,672 missing values generated)

.      replace momanycol2 = 0 if livwmom == 0;
(475,672 real changes made)

.          gen mtreduc = 1 if momhsdrop == 1;
(2,433,416 missing values generated)

.      replace mtreduc = 2 if momhsgrad == 1;
(1,158,283 real changes made)

.          replace mtreduc = 3 if momanycol == 1;
(799,461 real changes made)

. gen momnative = mombpl <= 56;

. gen momweakeng = momspeakeng == 6;

. rename statefip stfips;

. gen stbirth = bpl;

. drop if stbirth > 56;
(152,258 observations deleted)

. sort stbirth;

. save "$temp/temp1.dta", replace;
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/temp1.dta saved

. * Use data from Cascio and Lewis (2006) on school entry age laws to determine
> when students started school and what grade they should be in at the time of
> the 1980 Census;
. clear;

. use "$raw/convstate.dta";

. rename stfips stbirth;

. sort stbirth;

. merge 1:m stbirth using "$temp/temp1.dta";
(note: variable stbirth was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         3,063,509  (_merge==3)
    -----------------------------------------

. tab _merge;

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
            matched (3) |  3,063,509      100.00      100.00
------------------------+-----------------------------------
                  Total |  3,063,509      100.00

. drop _merge;

. gen qtrcut = 1 if stname == "AZ" | stname == "CT" | stname == "DE" |
>      stname == "FL" | stname == "MS" | stname == "NM" | stname == "VT" |
>          stname == "PA" | stname == "PA";
(2,661,497 missing values generated)

. replace qtrcut = 3 if stname == "CO" | stname == "DE" | stname == "KS" |
>      stname == "MD" | stname == "MN" | stname == "MT" | stname == "TX" |
>          stname == "UT" | stname == "NH" | stname == "IA" | stname == "WY" |
>          stname == "MO" | stname == "TN" | stname == "VA" | stname == "GA" |
>          stname == "IN" | stname == "MA" | stname == "WA";
(952,893 real changes made)

. replace qtrcut = 4 if qtrcut == .;
(1,716,679 real changes made)

.          gen female = sex == 2;

. gen hispanic = hispan ~= 0;

. gen white = race == 1;

. gen black = race == 2;

. gen whitenh = white == 1 & hispanic == 0;

. gen blacknh = black == 1 & hispanic == 0;

. gen othernh = white == 0 & black == 0 & hispanic == 0;

. gen native = bpl <= 56;

. gen immigbef69 = yrimmig > 0 & yrimmig < 1970;

. gen firstgen = native == 0;

. gen secondgen = native == 1 & momnative == 0;

. gen spanishhome = language == 12;

. gen othlanghome = language > 1;

. gen weakenglish = speakeng == 6;

. gen yearage6 = birthyr + 6;

. gen schlstartyr = birthyr + 6;

.      replace schlstartyr = birthyr + 7 if birthqtr == 3 & qtrcut == 3;
(252,047 real changes made)

.          replace schlstartyr = birthyr + 7 if birthqtr == 4 & qtrcut >= 3;
(669,381 real changes made)

. * note Census is conducted in the spring of 1980;
. gen hsclass = schlstartyr + 12;

. gen predgrade80 = 12 - (hsclass - 1980);

.   replace predgrade80 = 13 if predgrade80 >= 13;
(344,943 real changes made)

. gen grade80 = 0 if higraded <= 30;
(2,721,079 missing values generated)

.          replace grade80 = 1 if higraded >= 31 & higraded <= 40;
(165,010 real changes made)

.          replace grade80 = 2 if higraded >= 41 & higraded <= 50;
(166,937 real changes made)

.          replace grade80 = 3 if higraded >= 51 & higraded <= 60;
(181,048 real changes made)

.          replace grade80 = 4 if higraded >= 61 & higraded <= 70;
(181,189 real changes made)

.          replace grade80 = 5 if higraded >= 71 & higraded <= 80;
(177,085 real changes made)

.          replace grade80 = 6 if higraded >= 81 & higraded <= 90;
(174,402 real changes made)

.      replace grade80 = 7 if higraded >= 091 & higraded <= 100;
(179,548 real changes made)

.      replace grade80 = 8 if higraded >= 101 & higraded <= 110;
(193,478 real changes made)

.      replace grade80 = 9 if higraded >= 111 & higraded <= 120;
(214,040 real changes made)

.      replace grade80 = 10 if higraded >= 121 & higraded <= 130;
(233,538 real changes made)

.          replace grade80 = 11 if higraded >= 131 & higraded <= 140;
(214,635 real changes made)

.          replace grade80 = 12 if higraded == 141 | higraded == 142;
(175,773 real changes made)

.          replace grade80 = 13 if higraded >= 150;
(464,396 real changes made)

. gen gradeage = grade80 >= predgrade80;

. tab predgrade80, sum(gradeage);

            |         Summary of gradeage
predgrade80 |        Mean   Std. Dev.       Freq.
------------+------------------------------------
         -2 |           1           0      46,308
         -1 |           1           0     155,371
          0 |           1           0     153,239
          1 |   .92794011   .25858788     154,552
          2 |   .88120346   .32354994     162,631
          3 |   .86128577   .34564906     175,101
          4 |   .83449335    .3716382     184,337
          5 |   .84912843   .35792467     175,202
          6 |   .84176517   .36496212     170,386
          7 |   .83815229   .36831211     172,928
          8 |   .83023557   .37542676     179,054
          9 |   .81825519   .38563509     189,579
         10 |   .79778442   .40165315     197,601
         11 |   .75638944   .42926143     199,548
         12 |   .72168127   .44817231     199,444
         13 |   .77437672   .41799251     548,228
------------+------------------------------------
      Total |   .83702969   .36933864   3,063,509

. tab schlstartyr, sum(gradeage);

            |         Summary of gradeage
schlstartyr |        Mean   Std. Dev.       Freq.
------------+------------------------------------
       1965 |   .82484658   .38009963     140,140
       1966 |   .80163377   .39877042     204,803
       1967 |   .71212337   .45277443     203,285
       1968 |   .72168127   .44817231     199,444
       1969 |   .75638944   .42926143     199,548
       1970 |   .79778442   .40165315     197,601
       1971 |   .81825519   .38563509     189,579
       1972 |   .83023557   .37542676     179,054
       1973 |   .83815229   .36831211     172,928
       1974 |   .84176517   .36496212     170,386
       1975 |   .84912843   .35792467     175,202
       1976 |   .83449335    .3716382     184,337
       1977 |   .86128577   .34564906     175,101
       1978 |   .88120346   .32354994     162,631
       1979 |   .92794011   .25858788     154,552
       1980 |           1           0     153,239
       1981 |           1           0     155,371
       1982 |           1           0      46,308
------------+------------------------------------
      Total |   .83702969   .36933864   3,063,509

. keep if birthyr <= 1971;
(622,624 observations deleted)

. replace county = county/10;
(1,258,447 real changes made)

. replace county = . if county == 0;
(1,182,438 real changes made, 1,182,438 to missing)

. rename county ctyfips;

. sort year datanum serial pernum;

. save "$temp/temp1.dta", replace;
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/temp1.dta saved

. /*Generate a variable indicating whether each individual in the Census
> subsample has another person living in his/her household who was 0 to 4 years
> younger than them who may have been watching Sesame Street even after the
> individual started school*/
> 
> * create a dataset of the ages of the other people in the household;
. forvalues num = 1/20{;
  2. clear;
  3. use "$temp/temp1.dta";
  4. keep if pernum == `num';
  5. keep year datanum serial pernum age;
  6. rename age ageoth`num';
  7. gen pernumoth = `num';
  8. drop pernum;
  9. sort year datanum serial;
 10. save "$temp/tempsib`num'.dta", replace;
 11. };
(2,264,908 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib1.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib1.dta saved
(2,145,541 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib2.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib2.dta saved
(1,499,348 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib3.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib3.dta saved
(1,833,723 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib4.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib4.dta saved
(2,172,233 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib5.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib5.dta saved
(2,340,527 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib6.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib6.dta saved
(2,405,813 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib7.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib7.dta saved
(2,430,893 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib8.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib8.dta saved
(2,436,908 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib9.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib9.dta saved
(2,439,239 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib10.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib10.dta saved
(2,440,231 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib11.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib11.dta saved
(2,440,596 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib12.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib12.dta saved
(2,440,764 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib13.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib13.dta saved
(2,440,829 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib14.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib14.dta saved
(2,440,860 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib15.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib15.dta saved
(2,440,872 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib16.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib16.dta saved
(2,440,878 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib17.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib17.dta saved
(2,440,884 observations deleted)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib18.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib18.dta saved
(2,440,885 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib19.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib19.dta saved
(2,440,885 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib20.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib20.dta saved

. * merge these data back onto the main dataset to identify if those other people 
> are within 4 years younger;
. forvalues num = 1/20{;
  2. clear;
  3. use "$temp/temp1.dta";
  4. sort year datanum serial;
  5. merge year datanum serial using "$temp/tempsib`num'";
  6. drop _merge;
  7. gen agediff`num' = age - ageoth`num';
  8. replace agediff`num' = . if pernum == pernumoth;
  9. gen yngsib`num' = (agediff`num' >= 0 & agediff`num' <= 4) & 
>      (pernum ~= pernumoth);
 10. keep year datanum serial pernum pernumoth yngsib*;
 11. sort year datanum serial pernum;
 12. save "$temp/tempsib`num'", replace;
 13. };
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,227,717 missing values generated)
(175,977 real changes made, 175,977 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib1.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(1,938,117 missing values generated)
(295,344 real changes made, 295,344 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib2.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(602,995 missing values generated)
(941,537 real changes made, 941,537 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib3.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(932,953 missing values generated)
(607,162 real changes made, 607,162 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib4.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(1,586,077 missing values generated)
(268,652 real changes made, 268,652 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib5.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,049,485 missing values generated)
(100,358 real changes made, 100,358 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib6.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,281,232 missing values generated)
(35,072 real changes made, 35,072 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib7.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,387,350 missing values generated)
(9,992 real changes made, 9,992 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib8.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,417,327 missing values generated)
(3,977 real changes made, 3,977 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib9.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,430,410 missing values generated)
(1,646 real changes made, 1,646 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib10.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,436,483 missing values generated)
(654 real changes made, 654 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib11.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,438,864 missing values generated)
(289 real changes made, 289 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib12.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,439,999 missing values generated)
(121 real changes made, 121 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib13.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,440,446 missing values generated)
(56 real changes made, 56 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib14.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,440,692 missing values generated)
(25 real changes made, 25 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib15.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,440,772 missing values generated)
(13 real changes made, 13 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib16.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,440,827 missing values generated)
(7 real changes made, 7 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib17.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,440,879 missing values generated)
(1 real change made, 1 to missing)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib18.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,440,885 missing values generated)
(0 real changes made)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib19.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
variables year datanum serial do not uniquely identify observations in the master data
(2,440,885 missing values generated)
(0 real changes made)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsib20.dta saved

. *Determine whether individuals have ANY sibling within 4 years of age;
. use "$temp/tempsib1.dta";

. forvalues num = 2/20 {;
  2. sort year datanum serial pernum;
  3. merge year datanum serial pernum using 
>      "$temp/tempsib`num'.dta";
  4. drop _merge;
  5. sort year datanum serial pernum;
  6. save "$temp/tempsiball.dta", replace;
  7. };
(note: you are using old merge syntax; see [D] merge for new syntax)
(note: file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta not found)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved
(note: you are using old merge syntax; see [D] merge for new syntax)
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempsiball.dta saved

. gen yngsib = yngsib1;

. forvalues num = 2/20 {;
  2. replace yngsib = 1 if yngsib`num' == 1;
  3. };
(31,567 real changes made)
(114,554 real changes made)
(442,187 real changes made)
(204,426 real changes made)
(79,030 real changes made)
(27,618 real changes made)
(8,008 real changes made)
(3,056 real changes made)
(1,222 real changes made)
(419 real changes made)
(168 real changes made)
(65 real changes made)
(29 real changes made)
(12 real changes made)
(8 real changes made)
(5 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)

. keep year datanum serial pernum yngsib;

. sort year datanum serial pernum;

. merge year datanum serial pernum using "$temp/temp1.dta";
(note: you are using old merge syntax; see [D] merge for new syntax)

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |  2,440,885      100.00      100.00
------------+-----------------------------------
      Total |  2,440,885      100.00

. drop _merge;

. keep if birthyr <= 1968;
(531,813 observations deleted)

. * Drop those respondents who moved states between the time that they were
> born and the time they completed the Census;
. gen moved = stbirth ~= stfips;

. tab moved;

      moved |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,459,077       76.43       76.43
          1 |    449,995       23.57      100.00
------------+-----------------------------------
      Total |  1,909,072      100.00

. qui sum moved;

. global stay1980 = 1-r(mean);

. qui sum moved [aw=perwt];

. global stay1980_wt = 1-r(mean);

. drop if moved == 1;
(449,995 observations deleted)

. sort ctyfips stbirth;

. save "$temp/tempcens80.dta", replace;
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/tempcens80.dta saved

. * Merge in Sesame Street coverage data at the state level with state of
> birth from the Census data. Note that these data are the ones that Riley 
> coded that includes a few tweaks from the version I originally coded;
. clear;

. use "$raw/SScovcty_final.dta";

. sum covratehat [weight=pop70];
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
  covratehat |   3,022   200408456    .6509379   .1960907          0   .9487382

. keep ctyfips stfips covratehat vhfbest whenshow;

. rename stfips stbirth;

. sort ctyfips stbirth;

. merge ctyfips stbirth using "$temp/tempcens80.dta";
(note: you are using old merge syntax; see [D] merge for new syntax)
(note: variable stbirth was byte, now float to accommodate using data's values)
variables ctyfips stbirth do not uniquely identify observations in C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all
    files/data/temp/tempcens80.dta

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,759        0.19        0.19
          2 |    716,590       49.02       49.21
          3 |    742,487       50.79      100.00
------------+-----------------------------------
      Total |  1,461,836      100.00

. keep if _merge == 3;
(719,349 observations deleted)

. drop _merge;

. sort ctyfips stbirth;

. save "$temp/temp1.dta", replace;
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/temp1.dta saved

. * Merge in data on the availability of Food Stamps in the individual's county
> at the time of starting school and the fraction of the child's life between
> ages 0 and 6 that Food Stamps were available. These data were provided by
> Diane Schanzenbach.
> 
> clear;
. use "$raw/fs_background.dta";

. keep stfips countyfips fs_month fs_year;

. rename countyfips ctyfips;

. rename stfips stbirth;

. sort ctyfips stbirth;

. merge ctyfips stbirth using "$temp/temp1.dta";
(note: you are using old merge syntax; see [D] merge for new syntax)
variables ctyfips stbirth do not uniquely identify observations in C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all
    files/data/temp/temp1.dta

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,766        0.37        0.37
          3 |    742,487       99.63      100.00
------------+-----------------------------------
      Total |    745,253      100.00

. keep if _merge == 3;
(2,766 observations deleted)

. drop _merge;

. gen fsage6 = yearage6 >= fs_year;

. gen fsage0_6 = (yearage6 - fs_year)/6;

.      replace fsage0_6 = 0 if fsage0_6 < 0;
(253,224 real changes made)

.          replace fsage0_6 = 1 if fsage0_6 > 1;
(78,644 real changes made)

.          sort ctyfips stbirth yearage6;

. save "$temp/temp1.dta", replace;
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/temp1.dta saved

. * Merge in data on Head Start spending in the individual's county in the year
> the individual was age 4. These data are available from Ludgwig and Miller's
> 2007 QJE paper. Values are only available for 1968 and 1972. I linearly
> interpolate between those years to fill in. No spending took place before
> 1968;
.          */
> clear;
. use "$raw/ludwig_miller_HSspend.dta";

. rename qje68 hsspend68;

. rename qje72a hsspend72;

. keep oldcode hsspend* pop70;

. merge oldcode using "$raw/ludwig_miller_fipsrecode";
(note: you are using old merge syntax; see [D] merge for new syntax)
(note: variable oldcode was long, now double to accommodate using data's values)
variable oldcode does not uniquely identify observations in C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all
    files/data/raw/ludwig_miller_fipsrecode.dta

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |          7        0.22        0.22
          3 |      3,151       99.78      100.00
------------+-----------------------------------
      Total |      3,158      100.00

. keep if _merge == 3;
(7 observations deleted)

. drop _merge;

. rename state stbirth;

. rename county ctyfips;

. drop if ctyfips == .;
(14 observations deleted)

. sort cfips90;

. drop if cfips90 == cfips90[_n-1];
(2 observations deleted)

. reshape long hsspend, i(cfips90) j(year);
(note: j = 68 72)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     3135   ->    6270
Number of variables                   7   ->       7
j variable (2 values)                     ->   year
xij variables:
                    hsspend68 hsspend72   ->   hsspend
-----------------------------------------------------------------------------

. expand 6;
(31,350 observations created)

. sort cfips90 year;

. replace year = year + 1900;
variable year was byte now int
(37,620 real changes made)

. replace year = 1963 if cfips90 ~= cfips90[_n-1] & year == 1968;
(3,135 real changes made)

. replace year = year[_n-1] + 1 if cfips90 == cfips90[_n-1];
(28,215 real changes made)

. replace hsspend = 0 if year <= 1967;
(6,740 real changes made)

. replace hsspend = .75*hsspend[_n-1] + .25*hsspend[_n+3] if year == 1969;
(1,459 real changes made, 2 to missing)

. replace hsspend = .5*hsspend[_n-2] + .5*hsspend[_n+2] if year == 1970;
(1,459 real changes made, 2 to missing)

. replace hsspend = .25*hsspend[_n-3] + .75*hsspend[_n+1] if year == 1971;
(1,459 real changes made, 2 to missing)

. replace hsspend = hsspend[_n-4] if year == 1972;
(1,459 real changes made, 2 to missing)

. gen hspercap = hsspend/pop70;
(24 missing values generated)

. drop if year > 1972;
(6,270 observations deleted)

. gen yearage6 = year+2;

. drop cfips90 oldcode year pop70;

. sort ctyfips stbirth yearage6;

. merge ctyfips stbirth yearage6 using "$temp/temp1.dta";
(note: you are using old merge syntax; see [D] merge for new syntax)
variables ctyfips stbirth yearage6 do not uniquely identify observations in C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame
    Street\all files/data/temp/temp1.dta

. tab _merge;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     27,860        3.62        3.62
          2 |        765        0.10        3.72
          3 |    741,722       96.28      100.00
------------+-----------------------------------
      Total |    770,347      100.00

. keep if _merge == 3;
(28,625 observations deleted)

. drop _merge;

.                  sort ctyfips stbirth;

. save "$temp/gradeforage_cty.dta", replace;
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/gradeforage_cty.dta saved

. sort stbirth ctyfips yearage6;

. collapse (mean) gradeage (count) numobs80=gradeage, by(stbirth ctyfips yearage6);

. sort stbirth ctyfips yearage6;

. save "$temp/agggfa80_cty.dta", replace;
file C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/data/temp/agggfa80_cty.dta saved

. erase "$temp/temp1.dta";

. forvalues num = 1/20 {;
  2. erase "$temp/tempsib`num'.dta";
  3. };

. erase "$temp/tempsiball.dta";

. log close;
      name:  <unnamed>
       log:  C:\Users\georg\Dropbox\Economics\RA Tasks\Sesame Street\all files/logs/inpcensus80_cty.log
  log type:  text
 closed on:  20 Jun 2018, 14:42:15
--------------------------------------------------------------------------------------------------------------------------------
